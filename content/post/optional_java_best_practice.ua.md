+++
author = "Yevgen.P"
title = "–ì–æ—Ç—É—î–º–æ Optional –ø—Ä–∞–≤–∏–ª—å–Ω–æ, 5 –∫–æ—Ä–∏—Å–Ω–∏—Ö –ø–æ—Ä–∞–¥"
date = "2022-10-02"
description = "–¢–∏–ø–æ–≤—ñ –ø–æ–º–∏–ª–∫–∏ —ñ —è–∫ –Ω–µ –ø–æ–ø–∞—Å—Ç–∏—Å—è –Ω–∞ –Ω–∏—Ö"
tags = [
    "Java",
    "Optional",
]
categories = [
    "Java",
]
thumbnail = "images/optional-java.webp"
+++


–ù—É —â–æ –ø–æ—á–Ω–µ–º–æ, —Å–ø–æ–¥—ñ–≤–∞—é—Å—è —â–æ —Ç–∞–∫–µ NPE —Ç—É—Ç —Ä–æ–∑–ø–æ–≤—ñ–¥–∞—Ç–∏ –Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ –¥—É–º–∞—é –∫–æ–∂–µ–Ω –π–æ–≥–æ –æ—Ç—Ä–∏–º—É–≤–∞–≤ —ñ –∑–Ω–∞—î—à, —â–æ –∑ –Ω–∏–º —Ä–æ–±–∏—Ç–∏.
–ê –æ—Å—å Optional –ø—Ä–∏–π—à–æ–≤ –Ω–∞ –¥–æ–ø–æ–º–æ–≥—É —ñ –º–∞–≤ –¥–æ–ø–æ–º–æ–≥—Ç–∏ –≤ —Ü—å–æ–º—É. –¢—É—Ç –º–∏ —Å–ø—Ä–æ–±—É—î–º–æ –∑—Ä–æ–∑—É–º—ñ—Ç–∏ —á–∏ –¥–æ–ø–æ–º—ñ–≥ –≤—ñ–Ω —á–∏ ...

## –ù—É —â–æ –ø–æ—ó—Ö–∞–ª–∏ üôà. –¢–æ–ø 5 –∫–æ—Ä–∏—Å–Ω–∏—Ö –ø–æ—Ä–∞–¥

### 1. –ß–∏ –º–æ–∂—É —è –∑ Optional –æ—Ç—Ä–∏–º–∞—Ç–∏ NPE?

–Ü —Ç—É—Ç –Ω–∞ –∂–∞–ª—å —á—É–¥–µ—Å –Ω–µ–º–∞—î, –∑–≤—ñ—Å–Ω–æ –º–æ–∂–µ—Ç–µ. –ü—Ä–∏–≤–µ–¥—É —Ç–∏–ø–æ–≤–∏–π –ø—Ä–∏–∫–ª–∞–¥ –∫–æ–ª–∏ —Ü–µ –º–æ–∂–ª–∏–≤–æ:

```java
Optional<User> getUserBad(int id) {
    Optional<User> user = null;
    //logic query db or external service
    return user;
}
```

–î–æ–≤–æ–ª—ñ —Ç–∏–ø–æ–≤–∏–π –ø—Ä–∏–∫–ª–∞–¥ –≤–∏—Ç—è–≥–Ω—É—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑ –ë–î, –∞ —è–∫—â–æ –π–æ–≥–æ –Ω–µ–º–∞—î –ø–æ–≤–µ—Ä–Ω—É—Ç–∏ null.
–¢–∞–∫–∞ —Ç–∏–ø–æ–≤–∞ –ø–æ–º–∏–ª–∫–∞ –≤–∏–Ω–∏–∫–∞—î –∫–æ–ª–∏ –ø–æ—á–∏–Ω–∞—î—à –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ Optional, –∞–ª–µ —â–µ –ø–∏—à–µ—à –∫–æ–¥ –≤ —Å—Ç–∞—Ä–æ–º—É —Å—Ç–∏–ª—ñ.

–í—ñ—Ä–Ω–∏–π –≤–∞—Ä—ñ–∞–Ω—Ç –±—É–¥–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ empty.
```java
Optional<User> getUserBad(int id) {
    Optional<User> user = Optional.empty();
    //logic query db or external service
    return user;
}
```

#### –í–∏—Å–Ω–æ–≤–æ–∫ –∑ —Ü—å–æ–≥–æ –ø—Ä–∏–∫–ª–∞–¥—É –Ω—ñ–∫–æ–ª–∏ –Ω–µ –ø—Ä–∏–∑–Ω–∞—á–∞–π—Ç–µ –∑–Ω–∞—á–µ–Ω–Ω—è null Optional –∑–º—ñ–Ω–Ω—ñ–π.


### 2. –ü–æ–≤–µ—Ä–Ω—É—Ç–∏ –∑–Ω–∞—á–µ–Ω–Ω—è —è–∫—â–æ —î —á–∏ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—É

```java
public static final String UNDEFINED = "Undefined";

String userStatusBad(int id) {
    Optional<String> userStatus = Optional.empty(); // query db and get data could be empty
    // String status = UNDEFINED;
    if (userStatus.isPresent()) {
        status = userStatus.get();
    }

    return status;
}
```

–¶–µ–π –ø—Ä–∏–∫–ª–∞–¥ –ø–æ–≤—Å—Ç—é —Ä–æ–±–æ—á–∏–π, –∞–ª–µ –º–æ–∂–Ω–∞ –Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ isPresent —ñ get.

#### –í–∏—Å–Ω–æ–≤–æ–∫ –¥–ª—è —Ç–æ–≥–æ —â–æ –± —Ü–µ –∑—Ä–æ–±–∏—Ç–∏ –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ orElse

```java
String userStatus(int id) {
    Optional<String> userStatus = Optional.empty(); // query db and get data could be empty
    return userStatus.orElse(UNDEFINED);
}
```

–ê–ª–µ –Ω–µ –≤—Å–µ —Ç–∞–∫ –ø—Ä–æ—Å—Ç–æ, —è–∫ –Ω–∞ –ø–µ—Ä—à–∏–π –ø–æ–≥–ª—è–¥. –ü–µ—Ä—à–∏–π –Ω—é–∞–Ω—Å —Ü–µ —Ç–µ, —â–æ –≤ orElse –∑–∞–≤–∂–¥–∏ –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è –Ω–µ –∑–≤–∞–∂–∞—é—á–∏ —î –∑–Ω–∞—á–µ–Ω–Ω—è —á–∏ –Ω—ñ.
–¢–æ–º—É —Ç—É—Ç —Ç–µ–∂ –ø–æ—Ç—Ä—ñ–±–Ω–æ –π–æ–≥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –∑ —Ç–∏–º–∏ –∑–Ω–∞—á–µ–Ω–Ω—è–º–∏ —è–∫—ñ –Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤–∏—Ä–∞—Ö–æ–≤—É–≤–∞—Ç–∏. 
–ì–∞—Ä–Ω–∏–π –≤–∞—Ä—ñ–∞–Ω—Ç —Ü–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∏ —è–∫ —É –Ω–∞—Å –≤ –ø—Ä–∏–∫–ª–∞–¥—ñ.

### 3. –ù–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ orElse —è–∫—â–æ –≤–∞–º —Ç–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ —Å—Ö–æ–¥–∏—Ç–∏ –≤ –ë–î —á–∏ —â–µ –∫—É–¥–∏—Å—å.

```java
User getFromCacheOrDb(int id) {
    return getFromCache(id)
        .orElse(getFromDB(id).orElseThrow(() -> new UserNotFoundException("User with id" + id)));
}

Optional<User> getFromCache(int id) {
    System.out.println("search in cache with id " + id);
    return Optional.of(new User("levik", new ArrayList<>()));
}

Optional<User> getFromDB(int id) {
    System.out.println("search in DB with id " + id);
    return Optional.empty();
}
```

–í–∏–≤—ñ–¥ –≤–∏–∫–ª–∏–∫—É –º–µ—Ç–æ–¥–∞ getFromCacheOrDb —Å–ø–æ—á–∞—Ç–∫—É –ø—ñ–¥–µ –≤ –∫–µ—à, –∞ –ø–æ—Ç—ñ–º –Ω–µ–∑–∞–ª–µ–∂–Ω–æ –¥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É —Å—Ö–æ–¥–∏—Ç—å –≤ –±–¥. 
–Ü –≤–∏–≤—ñ–¥ –±—É–¥–µ —Ç–∞–∫–∏–π. –¶–µ –º–æ–∂–µ –ø—Ä–∏–∑–≤–µ—Å—Ç–∏ –¥–ª—è —É–ø–æ–≤—ñ–ª—å–Ω–µ–Ω–Ω—è –Ω–∞—à–æ—ó –∞–ø–ª—ñ–∫–∞—Ü—ñ—ó.

```java
search in cache with id 1
search in DB with id 1
```

–¶–µ –≤–∏—Ä—ñ—à—É—î—Ç—å—Å—è –º–µ—Ç–æ–¥–æ–º orElseGet –≤—ñ–Ω —è–∫—Ä–∞–∑ –±—É–¥–µ –≤–∏–∫–ª–∏–∫–∞–Ω–∏–π –∫–æ–ª–∏ –¥–∞–Ω–∏—Ö –≤ –∫–µ—à—ñ –Ω–µ –±—É–¥–µ.

```java
User getFromCacheOrDb(int id) {
    return getFromCache(id)
        .orElseGet(() -> getFromDB(id).orElseThrow(() -> new UserNotFoundException("User with id" + id)));
}
```

#### –í–∏—Å–Ω–æ–≤–æ–∫ —è–∫—â–æ —É –≤–∞—Å –ø–æ—Ö—ñ–¥ –≤ –ë–î —á–∏ —â–µ —â–æ—Å—å –∫—Ä–∞—â–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ orElseGet –¥–ª—è –∑–∞–ø–æ–±—ñ–≥–∞–Ω–Ω—è –ø—Ä–æ–±–ª–µ–º –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—é.

### 4. –ü–æ–≤–µ—Ä–Ω—É—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç —á–∏ –ø–æ–º–∏–ª–∫—É —è–∫—â–æ –π–æ–≥–æ –Ω–µ–º–∞—î

```java
User findUser(int id) {
    Optional<User> user = getFromDB(id);
    if (user.isPresent()) {
        return user.get();
    } else {
        throw new NoSuchElementException();
    }
}
```

–î–æ–≤–æ–ª—ñ —Ç–∏–ø–æ–≤–∏–π –ø—Ä–∏–∫–ª–∞–¥ –∫–æ–ª–∏ –≤–∏, —â–æ—Å—å –≤–∏—Ç—è–≥–ª–∏ –∑ –ë–î –∞–ª–µ –¥–∞–Ω–∏—Ö –Ω–µ–º–∞—î —ñ –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤–∏–∫–∏–Ω—É—Ç–∏ –ø–æ–º–∏–ª–∫—É.
–ê–ª–µ —ñ —Ç—É—Ç –º–æ–∂–Ω–∞ –∑—Ä–æ–±–∏—Ç–∏ –Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ isPresent —ñ get —î –∞–Ω–∞–ª–æ–≥—ñ—á–Ω–∏–π –º–µ—Ç–æ–¥ —è–∫–∏–π —Ü–µ —Ä–æ–±–∏—Ç—å orElseThrow

```java
User findUser(int id) {
    return getFromDB(id).orElseThrow();
}
```

–í—Å–µ —á—É–¥–æ–≤–æ, –∞–ª–µ –∑–∞–∑–≤–∏—á–∞–π. –ú–∏ —Å—Ç–≤–æ—Ä—é—î–º–æ –≤–ª–∞—Å–Ω–∏–π –≤–∏–Ω—è—Ç–æ–∫ —ñ –ø–æ–≤–µ—Ä—Ç–∞—î–º–æ –π–æ–≥–æ. –ß–∏ —î —è–∫—ñ—Å—å –≤–∞—Ä—ñ–∞–Ω—Ç–∏? 


### 5. –ü–æ–≤–µ—Ä–Ω—É—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç —á–∏ –≤–ª–∞—Å–Ω—É –ø–æ–º–∏–ª–∫—É —è–∫—â–æ –π–æ–≥–æ –Ω–µ–º–∞—î

–î—É–º–∞—é —è–∫ –Ω–∞–ø–∏—Å–∞—Ç–∏ –∑ isPresent —ñ get, –∞ —Ç–∞–∫–æ–∂ —Å–≤–æ—î—é –ø–æ–º–∏–ª–∫–æ—é –Ω–µ –≤–∏–Ω–∏–∫–Ω–µ –ø—Ä–æ–±–ª–µ–º. –ê–ª–µ –º–æ–∂–ª–∏–≤–æ —î —ñ–Ω—à—ñ –≤–∞—Ä—ñ–∞–Ω—Ç–∏. 

```java
User getFromCacheOrDb(int id) {
    return getFromCache(id)
        .orElseGet(() -> getFromDB(id).orElseThrow(() -> new UserNotFoundException("User with id" + id)));
}
```

–ù–∞—à –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–π –ø—Ä–∏–∫–ª–∞–¥ –∑ –∫–µ—à–µ–º —è–∫—â–æ –Ω–µ–º–∞—î —Å—Ö–æ–¥–∏–º–æ –≤ –ë–î —ñ —è–∫—â–æ —â–µ —Ç–∞–º –Ω–µ–º–∞—î —Ç–æ–¥—ñ –ø–æ–≤–µ—Ä–Ω–µ–º–æ –ø–æ–º–∏–ª–∫—É.
–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ orElseThrow –ø—Ä–∏–π–º–∞—î Supplier.

–ú–æ–∂–Ω–∞ —â–µ –∑—Ä–æ–±–∏—Ç–∏ —Ç—Ä–æ—Ö–∏ –ø–æ —ñ–Ω—à–æ–º—É —è–∫—â–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ –¥–µ—Ñ–æ–ª—Ç–Ω–∏–π –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –≤ –ø–æ–º–∏–ª—Ü—ñ —Ç–æ–¥—ñ –∫–æ–¥ –±—É–¥–µ –≤–∏–≥–ª—è–¥–∞—Ç–∏ —Ç–∞–∫.

```java
User getFromCacheOrDb(int id) {
    return getFromCache(id).orElseGet(() -> getFromDB(id).orElseThrow(UserNotFoundException::new));
}
```

#### –í–∏—Å–Ω–æ–≤–æ–∫ –¥–æ–≤–æ–ª—ñ –∑—Ä—É—á–Ω–∞ —ñ –ø—Ä–æ—Å—Ç–∞ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ isPresent —ñ get. –ü–æ–∫—Ä–∞—â—É—î —á–∏—Ç–∞–±–µ–ª—å–Ω—ñ—Å—Ç—å –∫–æ–¥—É.


### –í–∏—Å–Ω–æ–≤–∫–∏ —Å–ø–æ–¥—ñ–≤–∞—é—Å—å –¥–∞–Ω—ñ –ø–æ—Ä–∞–¥–∏ –±—É–ª–∏ –∫–æ—Ä–∏—Å–Ω–∏–º–∏. –†–µ–∫–æ–º–µ–Ω–¥—É—é —á–∏—Ç–∞—Ç–∏ JavaDoc —è–∫—â–æ —î –ø–µ–≤–Ω—ñ —Å—É–º–Ω—ñ–≤–∏ –≤—ñ–Ω –≤–∞–º –º–æ–∂–µ —Å—Ç–∞—Ç–∏ –≤ –ø—Ä–∏–≥–æ–¥—ñ. 



